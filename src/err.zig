const std = @import("std");

const c = @import("c");

const XrResult = enum(c_int) {
    success = 0,
    timeout_expired = 1,
    session_loss_pending = 3,
    event_unavailable = 4,
    space_bounds_unavailable = 7,
    session_not_focused = 8,
    frame_discarded = 9,
    validation_failure = -1,
    runtime_failure = -2,
    out_of_memory = -3,
    api_version_unsupported = -4,
    initialization_failed = -6,
    function_unsupported = -7,
    feature_unsupported = -8,
    extension_not_present = -9,
    limit_reached = -10,
    size_insufficient = -11,
    handle_invalid = -12,
    instance_lost = -13,
    session_running = -14,
    session_not_running = -16,
    session_lost = -17,
    system_invalid = -18,
    path_invalid = -19,
    path_count_exceeded = -20,
    path_format_invalid = -21,
    path_unsupported = -22,
    layer_invalid = -23,
    layer_limit_exceeded = -24,
    swapchain_rect_invalid = -25,
    swapchain_format_unsupported = -26,
    action_type_mismatch = -27,
    session_not_ready = -28,
    session_not_stopping = -29,
    time_invalid = -30,
    reference_space_unsupported = -31,
    file_access_error = -32,
    file_contents_invalid = -33,
    form_factor_unsupported = -34,
    form_factor_unavailable = -35,
    api_layer_not_present = -36,
    call_order_invalid = -37,
    graphics_device_invalid = -38,
    pose_invalid = -39,
    index_out_of_range = -40,
    view_configuration_type_unsupported = -41,
    environment_blend_mode_unsupported = -42,
    name_duplicated = -44,
    name_invalid = -45,
    actionset_not_attached = -46,
    actionsets_already_attached = -47,
    localized_name_duplicated = -48,
    localized_name_invalid = -49,
    graphics_requirements_call_missing = -50,
    runtime_unavailable = -51,
    extension_dependency_not_enabled = -1000710001,
    permission_insufficient = -1000710000,
    android_thread_settings_id_invalid_khr = -1000003000,
    android_thread_settings_failure_khr = -1000003001,
    create_spatial_anchor_failed_msft = -1000039001,
    secondary_view_configuration_type_not_enabled_msft = -1000053000,
    controller_model_key_invalid_msft = -1000055000,
    reprojection_mode_unsupported_msft = -1000066000,
    compute_new_scene_not_completed_msft = -1000097000,
    scene_component_id_invalid_msft = -1000097001,
    scene_component_type_mismatch_msft = -1000097002,
    scene_mesh_buffer_id_invalid_msft = -1000097003,
    scene_compute_feature_incompatible_msft = -1000097004,
    scene_compute_consistency_mismatch_msft = -1000097005,
    display_refresh_rate_unsupported_fb = -1000101000,
    color_space_unsupported_fb = -1000108000,
    space_component_not_supported_fb = -1000113000,
    space_component_not_enabled_fb = -1000113001,
    space_component_status_pending_fb = -1000113002,
    space_component_status_already_set_fb = -1000113003,
    unexpected_state_passthrough_fb = -1000118000,
    feature_already_created_passthrough_fb = -1000118001,
    feature_required_passthrough_fb = -1000118002,
    not_permitted_passthrough_fb = -1000118003,
    insufficient_resources_passthrough_fb = -1000118004,
    unknown_passthrough_fb = -1000118050,
    render_model_key_invalid_fb = -1000119000,
    render_model_unavailable_fb = 1000119020,
    marker_not_tracked_varjo = -1000124000,
    marker_id_invalid_varjo = -1000124001,
    marker_detector_permission_denied_ml = -1000138000,
    marker_detector_locate_failed_ml = -1000138001,
    marker_detector_invalid_data_query_ml = -1000138002,
    marker_detector_invalid_create_info_ml = -1000138003,
    marker_invalid_ml = -1000138004,
    localization_map_incompatible_ml = -1000139000,
    localization_map_unavailable_ml = -1000139001,
    localization_map_fail_ml = -1000139002,
    localization_map_import_export_permission_denied_ml = -1000139003,
    localization_map_permission_denied_ml = -1000139004,
    localization_map_already_exists_ml = -1000139005,
    localization_map_cannot_export_cloud_map_ml = -1000139006,
    spatial_anchors_permission_denied_ml = -1000140000,
    spatial_anchors_not_localized_ml = -1000140001,
    spatial_anchors_out_of_map_bounds_ml = -1000140002,
    spatial_anchors_space_not_locatable_ml = -1000140003,
    spatial_anchors_anchor_not_found_ml = -1000141000,
    spatial_anchor_name_not_found_msft = -1000142001,
    spatial_anchor_name_invalid_msft = -1000142002,
    scene_marker_data_not_string_msft = 1000147000,
    space_mapping_insufficient_fb = -1000169000,
    space_localization_failed_fb = -1000169001,
    space_network_timeout_fb = -1000169002,
    space_network_request_failed_fb = -1000169003,
    space_cloud_storage_disabled_fb = -1000169004,
    passthrough_color_lut_buffer_size_mismatch_meta = -1000266000,
    environment_depth_not_available_meta = 1000291000,
    hint_already_set_qcom = -1000306000,
    not_an_anchor_htc = -1000319000,
    space_not_locatable_ext = -1000429000,
    plane_detection_permission_denied_ext = -1000429001,
    future_pending_ext = -1000469001,
    future_invalid_ext = -1000469002,
    system_notification_permission_denied_ml = -1000473000,
    system_notification_incompatible_sku_ml = -1000473001,
    world_mesh_detector_permission_denied_ml = -1000474000,
    world_mesh_detector_space_not_locatable_ml = -1000474001,
    result_max_enum = 0x7fffffff,
};

pub const Error = @Type(.{ .error_set = blk: {
    const result_values = @typeInfo(XrResult).@"enum".fields;

    var errors: [result_values.len]std.builtin.Type.Error = undefined;

    for (&errors, result_values) |*err, result| {
        err.* = .{ .name = result.name };
    }

    break :blk &errors;
} });

pub fn handleResult(xr_ret: c.XrResult) Error!void {
    const result: XrResult = @enumFromInt(xr_ret);
    if (result == .success) return;

    return switch (result) {
        inline else => |error_result| @field(anyerror, @tagName(error_result)),
    };
}
